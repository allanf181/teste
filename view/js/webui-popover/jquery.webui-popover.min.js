!function(t,e,i){function o(e,i){this.$element=t(e),("string"===t.type(i.delay)||"number"===t.type(i.delay))&&(i.delay={show:i.delay,hide:i.delay}),this.options=t.extend({},h,i),this._defaults=h,this._name=n,this._targetclick=!1,this.init()}var n="webuiPopover",s="webui-popover",r="webui.popover",h={placement:"auto",width:"auto",height:"auto",trigger:"click",style:"",delay:{show:null,hide:null},async:{before:null,success:null},cache:!0,multi:!1,arrow:!0,title:"",content:"",closeable:!1,padding:!0,url:"",type:"html",constrains:null,animation:null,template:'<div class="webui-popover"><div class="arrow"></div><div class="webui-popover-inner"><a href="#" class="close">x</a><h3 class="webui-popover-title"></h3><div class="webui-popover-content"><i class="icon-refresh"></i> <p>&nbsp;</p></div></div></div>'};o.prototype={init:function(){"click"===this.getTrigger()&&this.$element.off("click").on("click",t.proxy(this.toggle,this)),"start"===this.getTrigger()?(this.show(),this.$element.off("mouseenter mouseleave").on("mouseenter",t.proxy(this.mouseenterHandler,this)).on("mouseleave",t.proxy(this.mouseleaveHandler,this))):this.$element.off("mouseenter mouseleave").on("mouseenter",t.proxy(this.mouseenterHandler,this)).on("mouseleave",t.proxy(this.mouseleaveHandler,this)),this._poped=!1,this._inited=!0},destroy:function(){this.hide(),this.$element.data("plugin_"+n,null),"click"===this.getTrigger()&&this.$element.off("click"),this.$element.off("start"===this.getTrigger()?"click":"mouseenter mouseleave"),this.$target&&this.$target.remove()},hide:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.xhr&&(this.xhr.abort(),this.xhr=null);var i=t.Event("hide."+r);this.$element.trigger(i),this.$target&&this.$target.removeClass("in").hide(),this.$element.trigger("hidden."+r)},toggle:function(t){t&&(t.preventDefault(),t.stopPropagation()),this[this.getTarget().hasClass("in")?"hide":"show"]()},hideAll:function(){t("div.webui-popover").not(".webui-popover-fixed").removeClass("in").hide()},show:function(){var t=this.getTarget().removeClass().addClass(s);if(this.options.multi||this.hideAll(),!this.getCache()||!this._poped){if(this.content="",this.setTitle(this.getTitle()),this.getCloseable()||t.find(".close").off("click").remove(),this.isAsync())return this.setContentASync(this.options.content),void this.displayContent();this.setContent(this.getContent()),t.show()}this.displayContent(),this.bindBodyEvents()},displayContent:function(){var e=this.getElementPosition(),o=this.getTarget().removeClass().addClass(s),n=this.getContentElement(),h=o[0].offsetWidth,a=o[0].offsetHeight,l="bottom",c=t.Event("show."+r);this.$element.trigger(c),"auto"!==this.options.width&&o.width(this.options.width),"auto"!==this.options.height&&n.height(this.options.height),this.options.arrow||o.find(".arrow").remove(),o.remove().css({top:-1e3,left:-1e3,display:"block"}),this.getAnimation()&&o.addClass(this.getAnimation()),o.appendTo(i.body),h=o[0].offsetWidth,a=o[0].offsetHeight,l=this.getPlacement(e),this.initTargetEvents();var p=this.getTargetPositin(e,l,h,a);if(this.$target.css(p.position).addClass(l).addClass("in"),"iframe"===this.options.type){var f=o.find("iframe");f.width(o.width()).height(f.parent().height())}if(this.options.style&&this.$target.addClass(s+"-"+this.options.style),this.options.padding||(n.css("height",n.outerHeight()),this.$target.addClass("webui-no-padding")),this.options.arrow||this.$target.css({margin:0}),this.options.arrow){var g=this.$target.find(".arrow");g.removeAttr("style"),p.arrowOffset&&g.css(p.arrowOffset)}this._poped=!0,this.$element.trigger("shown."+r)},isTargetLoaded:function(){return 0===this.getTarget().find("i.glyphicon-refresh").length},getTarget:function(){return this.$target||(this.$target=t(this.options.template)),this.$target},getTitleElement:function(){return this.getTarget().find("."+s+"-title")},getContentElement:function(){return this.getTarget().find("."+s+"-content")},getTitle:function(){return this.$element.attr("data-title")||this.options.title||this.$element.attr("title")},getUrl:function(){return this.$element.attr("data-url")||this.options.url},getCloseable:function(){return this.$element.attr("data-closeable")||this.options.closeable},getCache:function(){var t=this.$element.attr("data-cache");if("undefined"!=typeof t)switch(t.toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":return!1}return this.options.cache},getTrigger:function(){return this.$element.attr("data-trigger")||this.options.trigger},getDelayShow:function(){var t=this.$element.attr("data-delay-show");return"undefined"!=typeof t?t:this.options.delay.show||100},getHideDelay:function(){var t=this.$element.attr("data-delay-hide");return"undefined"!=typeof t?t:this.options.delay.hide||100},getConstrains:function(){var t=this.$element.attr("data-contrains");return"undefined"!=typeof t?t:this.options.constrains},getAnimation:function(){var t=this.$element.attr("data-animation");return t||this.options.animation},setTitle:function(t){var e=this.getTitleElement();t?e.html(t):e.remove()},hasContent:function(){return this.getContent()},getContent:function(){if(this.getUrl())"iframe"===this.options.type&&(this.content=t('<iframe frameborder="0"></iframe>').attr("src",this.getUrl()));else if(!this.content){var e="";e=t.isFunction(this.options.content)?this.options.content.apply(this.$element[0],arguments):this.options.content,this.content=this.$element.attr("data-content")||e}return this.content},setContent:function(t){var e=this.getTarget();this.getContentElement().html(t),this.$target=e},isAsync:function(){return"async"===this.options.type},setContentASync:function(e){var i=this;this.xhr=t.ajax({url:this.getUrl(),type:"GET",cache:this.getCache(),beforeSend:function(t){i.options.async.before&&i.options.async.before(i,t)},success:function(o){i.bindBodyEvents(),i.content=e&&t.isFunction(e)?e.apply(i.$element[0],[o]):o,i.setContent(i.content);var n=i.getContentElement();n.removeAttr("style"),i.displayContent(),i.options.async.success&&i.options.async.success(i,o),this.xhr=null}})},bindBodyEvents:function(){t("body").off("keyup.webui-popover").on("keyup.webui-popover",t.proxy(this.escapeHandler,this)),t("body").off("click.webui-popover").on("click.webui-popover",t.proxy(this.bodyClickHandler,this))},mouseenterHandler:function(){var t=this;t._timeout&&clearTimeout(t._timeout),t._enterTimeout=setTimeout(function(){t.getTarget().is(":visible")||t.show()},this.getDelayShow())},mouseleaveHandler:function(){var t=this;clearTimeout(t._enterTimeout),t._timeout=setTimeout(function(){t.hide()},this.getHideDelay())},escapeHandler:function(t){27===t.keyCode&&this.hideAll()},bodyClickHandler:function(){this._targetclick?this._targetclick=!1:this.hideAll()},targetClickHandler:function(){this._targetclick=!0},initTargetEvents:function(){"click"!==this.getTrigger()&&this.$target.off("mouseenter mouseleave").on("mouseenter",t.proxy(this.mouseenterHandler,this)).on("mouseleave",t.proxy(this.mouseleaveHandler,this)),this.$target.find(".close").off("click").on("click",t.proxy(this.hide,this)),this.$target.off("click.webui-popover").on("click.webui-popover",t.proxy(this.targetClickHandler,this))},getPlacement:function(t){var e,o=i.documentElement,n=i.body,s=o.clientWidth,r=o.clientHeight,h=Math.max(n.scrollTop,o.scrollTop),a=Math.max(n.scrollLeft,o.scrollLeft),l=Math.max(0,t.left-a),c=Math.max(0,t.top-h);if(e="function"==typeof this.options.placement?this.options.placement.call(this,this.getTarget()[0],this.$element[0]):this.$element.data("placement")||this.options.placement,"auto"===e){var p="horizontal"===this.getConstrains(),f="vertical"===this.getConstrains();e=s/3>l?r/3>c?p?"right-bottom":"bottom-right":2*r/3>c?f?r/2>=c?"bottom-right":"top-right":"right":p?"right-top":"top-right":2*s/3>l?r/3>c?p?s/2>=l?"right-bottom":"left-bottom":"bottom":2*r/3>c?p?s/2>=l?"right":"left":r/2>=c?"bottom":"top":p?s/2>=l?"right-top":"left-top":"top":r/3>c?p?"left-bottom":"bottom-left":2*r/3>c?f?r/2>=c?"bottom-left":"top-left":"left":p?"left-top":"top-left"}return e},getElementPosition:function(){return t.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTargetPositin:function(t,e,i,o){var n=t,s=this.$element.outerWidth(),r=this.$element.outerHeight(),h={},a=null,l=this.options.arrow?20:0,c=l+10>s?l:0,p=l+10>r?l:0;switch(e){case"bottom":h={top:n.top+n.height,left:n.left+n.width/2-i/2};break;case"top":h={top:n.top-o,left:n.left+n.width/2-i/2};break;case"left":h={top:n.top+n.height/2-o/2,left:n.left-i};break;case"right":h={top:n.top+n.height/2-o/2,left:n.left+n.width};break;case"top-right":h={top:n.top-o,left:n.left-c},a={left:Math.min(s,i)/2+c};break;case"top-left":h={top:n.top-o,left:n.left-i+n.width+c},a={left:i-Math.min(s,i)/2-c};break;case"bottom-right":h={top:n.top+n.height,left:n.left-c},a={left:Math.min(s,i)/2+c};break;case"bottom-left":h={top:n.top+n.height,left:n.left-i+n.width+c},a={left:i-Math.min(s,i)/2-c};break;case"right-top":h={top:n.top-o+n.height+p,left:n.left+n.width},a={top:o-Math.min(r,o)/2-p};break;case"right-bottom":h={top:n.top-p,left:n.left+n.width},a={top:Math.min(r,o)/2+p};break;case"left-top":h={top:n.top-o+n.height+p,left:n.left-i},a={top:o-Math.min(r,o)/2-p};break;case"left-bottom":h={top:n.top-p,left:n.left-i},a={top:Math.min(r,o)/2+p}}return{position:h,arrowOffset:a}}},t.fn[n]=function(e){return this.each(function(){var i=t.data(this,"plugin_"+n);i?"destroy"===e?i.destroy():"string"==typeof e&&i[e]():(e?"string"==typeof e?"destroy"!==e&&(i=new o(this,null),i[e]()):"object"==typeof e&&(i=new o(this,e)):i=new o(this,null),t.data(this,"plugin_"+n,i))})}}(jQuery,window,document);