<?php

include "inc/config.inc.php";

class Academico52 extends Ruckusing_Migration_Base {

    public function up() {
        // ARRUMAR RELACIONAMENTOS EM PESSOAS
        $result = $this->select_all("SELECT * FROM information_schema.TABLE_CONSTRAINTS 
                                WHERE
                                CONSTRAINT_SCHEMA = DATABASE() AND
                                CONSTRAINT_NAME   = 'fk_QuestionarioRespostas_QuestionarioQuestoes1' AND
                                CONSTRAINT_TYPE   = 'FOREIGN KEY'");
        if ($result) {
            $this->execute("ALTER TABLE  `QuestionariosRespostas` DROP FOREIGN KEY `fk_QuestionarioRespostas_QuestionarioQuestoes1` ;
                            ALTER TABLE  `QuestionariosRespostas` ADD CONSTRAINT `fk_QuestionarioRespostas_QuestionarioQuestoes1` FOREIGN KEY (  `questao` ) REFERENCES  `academico`.`QuestionariosQuestoes` (
                            `codigo`
                            ) ON DELETE CASCADE ON UPDATE CASCADE ;
                            ");
        }
        
        //PADRONIZA OS MENUS
        $result = $this->select_all("SELECT prof,aluno,adm,sec,ged,ssp,coord FROM Instituicoes");
        $prof = $result[0]['prof'];
        $aluno = $result[0]['aluno'];
        $adm = $result[0]['adm'];
        $sec = $result[0]['sec'];
        $ged = $result[0]['ged'];
        $ssp = $result[0]['ssp'];
        $coord = $result[0]['coord'];

        $this->execute("UPDATE `academico`.`Permissoes` SET `permissao` = 'view/aluno/aluno.php,view/aluno/arquivo.php,view/aluno/atendimento.php,view/aluno/atvAcadEmica.php,view/aluno/aula.php,view/aluno/avaliacao.php,view/aluno/aviso.php,view/aluno/boletim.php,view/aluno/bolsa.php,view/aluno/calendario.php,view/aluno/chat.php,view/aluno/ensalamento.php,view/aluno/planoEnsino.php,view/aluno/questionario.php',
                            `nome` = ',Material de Aula,Atendimento do Professor,Atividades Acad&ecirc;micas,Aulas,Avalia&ccedil;&otilde;es,Avisos,Boletim,Bolsas,Calend&aacute;rio Escolar,Chat (Atendimento),Ensalamento,Plano de Ensino,Question&aacute;rios',
                            `menu` = ',,view/aluno/atendimento.php,,,,,,view/aluno/bolsa.php,view/aluno/calendario.php,,view/aluno/ensalamento.php,,view/aluno/questionario.php' WHERE `Permissoes`.`tipo` = $aluno ");

        $this->execute("UPDATE `academico`.`Permissoes` SET `permissao` = 'view/secretaria/ocorrencia.php,view/professor/atribuicao/atendimento.php,view/professor/atribuicao/fpa.php,view/professor/atribuicao/pit.php,view/professor/atribuicao/rit.php,view/professor/arquivo.php,view/professor/aula.php,view/professor/aulaTroca.php,view/professor/avaliacao.php,view/professor/aviso.php,view/professor/boletim.php,view/professor/bolsa.php,view/professor/calendario.php,view/professor/chamada.php,view/professor/chat.php,view/professor/diario.php,view/professor/ensalamento.php,view/professor/frequencia.php,view/professor/nota.php,view/professor/plano.php,view/professor/professor.php,view/professor/questionario.php', `nome` = 'Ocorr&ecirc;ncias,Atendimento ao Aluno,FPA (Prefer&ecirc;ncia Atividades),PIT (Plano I. Trabalho),RIT (Relat&oacute;rio I. Trabalho),Material de Aula,Aulas,Aulas (Trocas/Reposi&ccedil;&otilde;es),Avalia&ccedil;&otilde;es,Avisos,Boletim do Aluno,Bolsas,Calend&aacute;rio Escolar,Lista de Chamada,Chat (Atendimento),Di&aacute;rios,Ensalamento,Frequ&ecirc;ncias,Notas,Planos de Ensino,,Question&aacute;rios', `menu` = 'view/secretaria/ocorrencia.php,view/professor/atribuicao/atendimento.php,view/professor/atribuicao/fpa.php,view/professor/atribuicao/pit.php,view/professor/atribuicao/rit.php,,,view/professor/aulaTroca.php,,,,view/professor/bolsa.php,view/professor/calendario.php,,,,view/professor/ensalamento.php,,,,,view/professor/questionario.php' WHERE `Permissoes`.`tipo` = $prof ");

        $this->execute("UPDATE `academico`.`Permissoes` SET `permissao` = 'view/secretaria/relatorios/boletimTurma.php,view/secretaria/relatorios/frequencias.php,view/secretaria/relatorios/listagem.php,view/secretaria/prazos/diario.php,view/secretaria/ensalamento/ensalamento.php,view/secretaria/ensalamento/horario.php,view/secretaria/ensalamento/sala.php,view/secretaria/cursos/atribuicao.php,view/secretaria/cursos/coordenador.php,view/secretaria/cursos/curso.php,view/secretaria/cursos/disciplina.php,view/secretaria/cursos/matricula.php,view/secretaria/cursos/modalidade.php,view/secretaria/cursos/notasFinais.php,view/secretaria/cursos/professorAtribuicao.php,view/secretaria/cursos/situacao.php,view/secretaria/cursos/tipoAvaliacao.php,view/secretaria/cursos/turma.php,view/secretaria/cursos/turno.php,view/secretaria/abono.php,view/secretaria/aviso.php,view/secretaria/calendario.php,view/secretaria/pessoa.php,view/secretaria/plano.php,view/admin/instituicao.php,view/admin/logs.php,view/admin/permissao.php,view/admin/sincronizadorNambei.php,view/admin/tipo.php,view/admin/usoSistema.php,view/secretaria/relatorios/ausencias.php,view/secretaria/relatorios/atendimento.php,view/secretaria/relatorios/inconsistenciasNambei.php,view/secretaria/atribuicao_docente/fpa.php,view/secretaria/atribuicao_docente/pit.php,view/secretaria/atribuicao_docente/rit.php,view/secretaria/cursos/area.php,view/secretaria/relatorios/boletim.php,view/secretaria/cursos/atividade_academica/atvAcadEmica.php,view/secretaria/cursos/atividade_academica/atvAcadItem.php,view/secretaria/cursos/atividade_academica/atvAcadRegistro.php,view/secretaria/relatorios/inc/atvAcadEmica.php,view/secretaria/atribuicao_docente/ftd.php,view/admin/cidade.php,view/admin/estado.php,view/secretaria/ocorrencia.php,view/secretaria/questionario.php,view/secretaria/bolsa.php', `nome` = 'Boletim por Turma,Frequ&ecirc;ncias,Relatórios (em PDF),Di&aacute;rios,Ensalamento,Hor&aacute;rios,Salas,Atribui&ccedil;&otilde;es,Coordenadores,Cursos,Disciplinas,Matr&iacute;&shy;culas,Modalidades,Notas Finais,Professores,Situa&ccedil;&otilde;es,Tipos de Avalia&ccedil;&otilde;es,Turmas,Turnos,Abono de Faltas,Avisos,Calend&aacute;rio Acad&ecirc;mico,Pessoas,Planos de Ensino,Institui&ccedil;&atilde;o,Logs,Permiss&otilde;es,Sincronizar Nambei,Tipos,Uso do Sistema,Aus&ecirc;ncias,Atendimento do Professor,Inconsistências Nambei,FPA (Prefer&ecirc;ncia Atividades),PIT (Plano I. Trabalho),RIT (Relat&oacute;rio I. Trabalho),&Aacute;reas,Boletim do Aluno,Cadastro de Atividades,Itens de Atividades,Registro de Alunos,Atividades Acadêmicas,FTDs (descontinuado),Cidades,Estados,Ocorr&ecirc;ncias,Questionários,Bolsas', `menu` = 'view/secretaria/relatorios/boletimTurma.php,view/secretaria/relatorios/frequencias.php,view/secretaria/relatorios/listagem.php,view/secretaria/prazos/diario.php,view/secretaria/ensalamento/ensalamento.php,view/secretaria/ensalamento/horario.php,view/secretaria/ensalamento/sala.php,view/secretaria/cursos/atribuicao.php,view/secretaria/cursos/coordenador.php,view/secretaria/cursos/curso.php,view/secretaria/cursos/disciplina.php,view/secretaria/cursos/matricula.php,view/secretaria/cursos/modalidade.php,view/secretaria/cursos/notasFinais.php,view/secretaria/cursos/professorAtribuicao.php,view/secretaria/cursos/situacao.php,view/secretaria/cursos/tipoAvaliacao.php,view/secretaria/cursos/turma.php,view/secretaria/cursos/turno.php,view/secretaria/abono.php,view/secretaria/aviso.php,view/secretaria/calendario.php,view/secretaria/pessoa.php,view/secretaria/plano.php,view/admin/instituicao.php,view/admin/logs.php,view/admin/permissao.php,view/admin/sincronizadorNambei.php,view/admin/tipo.php,view/admin/usoSistema.php,view/secretaria/relatorios/ausencias.php,view/secretaria/relatorios/atendimento.php,view/secretaria/relatorios/inconsistenciasNambei.php,view/secretaria/atribuicao_docente/fpa.php,view/secretaria/atribuicao_docente/pit.php,view/secretaria/atribuicao_docente/rit.php,view/secretaria/cursos/area.php,view/secretaria/relatorios/boletim.php,view/secretaria/cursos/atividade_academica/atvAcadEmica.php,view/secretaria/cursos/atividade_academica/atvAcadItem.php,view/secretaria/cursos/atividade_academica/atvAcadRegistro.php,,view/secretaria/atribuicao_docente/ftd.php,view/admin/cidade.php,view/admin/estado.php,view/secretaria/ocorrencia.php,view/secretaria/questionario.php,view/secretaria/bolsa.php' WHERE `Permissoes`.`tipo` = $adm; ");
       
        $this->execute("UPDATE `academico`.`Permissoes` SET `permissao` = 'view/secretaria/relatorios/atendimento.php,view/secretaria/relatorios/ausencias.php,view/secretaria/relatorios/boletim.php,view/secretaria/relatorios/boletimTurma.php,view/secretaria/relatorios/frequencias.php,view/secretaria/relatorios/inconsistenciasNambei.php,view/secretaria/relatorios/listagem.php,view/secretaria/prazos/diario.php,view/secretaria/ensalamento/ensalamento.php,view/secretaria/ensalamento/horario.php,view/secretaria/ensalamento/sala.php,view/secretaria/cursos/atividade_academica/atvAcadEmica.php,view/secretaria/cursos/atividade_academica/atvAcadItem.php,view/secretaria/cursos/atividade_academica/atvAcadRegistro.php,view/secretaria/cursos/area.php,view/secretaria/cursos/atribuicao.php,view/secretaria/cursos/coordenador.php,view/secretaria/cursos/curso.php,view/secretaria/cursos/disciplina.php,view/secretaria/cursos/matricula.php,view/secretaria/cursos/modalidade.php,view/secretaria/cursos/notasFinais.php,view/secretaria/cursos/professorAtribuicao.php,view/secretaria/cursos/situacao.php,view/secretaria/cursos/tipoAvaliacao.php,view/secretaria/cursos/turma.php,view/secretaria/cursos/turno.php,view/secretaria/atribuicao_docente/fpa.php,view/secretaria/atribuicao_docente/ftd.php,view/secretaria/atribuicao_docente/pit.php,view/secretaria/atribuicao_docente/rit.php,view/secretaria/abono.php,view/secretaria/aviso.php,view/secretaria/bolsa.php,view/secretaria/calendario.php,view/secretaria/ocorrencia.php,view/secretaria/pessoa.php,view/secretaria/plano.php,view/secretaria/questionario.php,view/admin/usoSistema.php', `nome` = 'Atendimento do Professor,Aus&ecirc;ncias,Boletim do Aluno,Boletim por Turma,Frequ&ecirc;ncias,Inconsist&ecirc;ncias Nambei,Relat&oacute;rios (em PDF),Di&aacute;rios,Ensalamento,Hor&aacute;rios,Salas,Cadastro de Atividades,Itens de Atividades,Registro de Alunos,&Aacute;reas,Atribui&ccedil;&otilde;es,Coordenadores,Cursos,Disciplinas,Matr&iacute;&shy;culas,Modalidades,Notas Finais,Professores,Situa&ccedil;&otilde;es,Tipos de Avalia&ccedil;&otilde;es,Turmas,Turnos,FPA (Prefer&ecirc;ncia Atividades),FTDs (descontinuado),PIT (Plano I. Trabalho),RIT (Relat&oacute;rio I. Trabalho),Abono de Faltas,Avisos,Bolsas,Calend&aacute;rio Acad&ecirc;mico,Ocorr&ecirc;ncias,Pessoas,Planos de Ensino,Question&aacute;rios,Uso do Sistema', `menu` = 'view/secretaria/relatorios/atendimento.php,view/secretaria/relatorios/ausencias.php,view/secretaria/relatorios/boletim.php,view/secretaria/relatorios/boletimTurma.php,view/secretaria/relatorios/frequencias.php,view/secretaria/relatorios/inconsistenciasNambei.php,view/secretaria/relatorios/listagem.php,view/secretaria/prazos/diario.php,view/secretaria/ensalamento/ensalamento.php,view/secretaria/ensalamento/horario.php,view/secretaria/ensalamento/sala.php,view/secretaria/cursos/atividade_academica/atvAcadEmica.php,view/secretaria/cursos/atividade_academica/atvAcadItem.php,view/secretaria/cursos/atividade_academica/atvAcadRegistro.php,view/secretaria/cursos/area.php,view/secretaria/cursos/atribuicao.php,view/secretaria/cursos/coordenador.php,view/secretaria/cursos/curso.php,view/secretaria/cursos/disciplina.php,view/secretaria/cursos/matricula.php,view/secretaria/cursos/modalidade.php,view/secretaria/cursos/notasFinais.php,view/secretaria/cursos/professorAtribuicao.php,view/secretaria/cursos/situacao.php,view/secretaria/cursos/tipoAvaliacao.php,view/secretaria/cursos/turma.php,view/secretaria/cursos/turno.php,view/secretaria/atribuicao_docente/fpa.php,view/secretaria/atribuicao_docente/ftd.php,view/secretaria/atribuicao_docente/pit.php,view/secretaria/atribuicao_docente/rit.php,view/secretaria/abono.php,view/secretaria/aviso.php,view/secretaria/bolsa.php,view/secretaria/calendario.php,view/secretaria/ocorrencia.php,view/secretaria/pessoa.php,view/secretaria/plano.php,view/secretaria/questionario.php,view/admin/usoSistema.php' WHERE `Permissoes`.`tipo` = $sec; ");
        
        $this->execute("UPDATE `academico`.`Permissoes` SET `permissao` = 'view/secretaria/relatorios/atendimento.php,view/secretaria/relatorios/ausencias.php,view/secretaria/relatorios/boletim.php,view/secretaria/relatorios/boletimTurma.php,view/secretaria/relatorios/frequencias.php,view/secretaria/relatorios/inconsistenciasNambei.php,view/secretaria/relatorios/listagem.php,view/secretaria/prazos/diario.php,view/secretaria/ensalamento/ensalamento.php,view/secretaria/ensalamento/horario.php,view/secretaria/ensalamento/sala.php,view/secretaria/cursos/atividade_academica/atvAcadEmica.php,view/secretaria/cursos/atividade_academica/atvAcadItem.php,view/secretaria/cursos/atividade_academica/atvAcadRegistro.php,view/secretaria/cursos/area.php,view/secretaria/cursos/atribuicao.php,view/secretaria/cursos/coordenador.php,view/secretaria/cursos/curso.php,view/secretaria/cursos/disciplina.php,view/secretaria/cursos/matricula.php,view/secretaria/cursos/modalidade.php,view/secretaria/cursos/notasFinais.php,view/secretaria/cursos/professorAtribuicao.php,view/secretaria/cursos/situacao.php,view/secretaria/cursos/tipoAvaliacao.php,view/secretaria/cursos/turma.php,view/secretaria/cursos/turno.php,view/secretaria/atribuicao_docente/fpa.php,view/secretaria/atribuicao_docente/ftd.php,view/secretaria/atribuicao_docente/pit.php,view/secretaria/atribuicao_docente/rit.php,view/secretaria/abono.php,view/secretaria/aviso.php,view/secretaria/bolsa.php,view/secretaria/calendario.php,view/secretaria/ocorrencia.php,view/secretaria/pessoa.php,view/secretaria/plano.php,view/secretaria/questionario.php,view/admin/usoSistema.php', `nome` = 'Atendimento do Professor,Aus&ecirc;ncias,Boletim do Aluno,Boletim por Turma,Frequ&ecirc;ncias,Inconsist&ecirc;ncias Nambei,Relat&oacute;rios (em PDF),Di&aacute;rios,Ensalamento,Hor&aacute;rios,Salas,Cadastro de Atividades,Itens de Atividades,Registro de Alunos,&Aacute;reas,Atribui&ccedil;&otilde;es,Coordenadores,Cursos,Disciplinas,Matr&iacute;&shy;culas,Modalidades,Notas Finais,Professores,Situa&ccedil;&otilde;es,Tipos de Avalia&ccedil;&otilde;es,Turmas,Turnos,FPA (Prefer&ecirc;ncia Atividades),FTDs (descontinuado),PIT (Plano I. Trabalho),RIT (Relat&oacute;rio I. Trabalho),Abono de Faltas,Avisos,Bolsas,Calend&aacute;rio Acad&ecirc;mico,Ocorr&ecirc;ncias,Pessoas,Planos de Ensino,Question&aacute;rios,Uso do Sistema', `menu` = 'view/secretaria/relatorios/atendimento.php,view/secretaria/relatorios/ausencias.php,view/secretaria/relatorios/boletim.php,view/secretaria/relatorios/boletimTurma.php,view/secretaria/relatorios/frequencias.php,view/secretaria/relatorios/inconsistenciasNambei.php,view/secretaria/relatorios/listagem.php,view/secretaria/prazos/diario.php,view/secretaria/ensalamento/ensalamento.php,view/secretaria/ensalamento/horario.php,view/secretaria/ensalamento/sala.php,view/secretaria/cursos/atividade_academica/atvAcadEmica.php,view/secretaria/cursos/atividade_academica/atvAcadItem.php,view/secretaria/cursos/atividade_academica/atvAcadRegistro.php,view/secretaria/cursos/area.php,view/secretaria/cursos/atribuicao.php,view/secretaria/cursos/coordenador.php,view/secretaria/cursos/curso.php,view/secretaria/cursos/disciplina.php,view/secretaria/cursos/matricula.php,view/secretaria/cursos/modalidade.php,view/secretaria/cursos/notasFinais.php,view/secretaria/cursos/professorAtribuicao.php,view/secretaria/cursos/situacao.php,view/secretaria/cursos/tipoAvaliacao.php,view/secretaria/cursos/turma.php,view/secretaria/cursos/turno.php,view/secretaria/atribuicao_docente/fpa.php,view/secretaria/atribuicao_docente/ftd.php,view/secretaria/atribuicao_docente/pit.php,view/secretaria/atribuicao_docente/rit.php,view/secretaria/abono.php,view/secretaria/aviso.php,view/secretaria/bolsa.php,view/secretaria/calendario.php,view/secretaria/ocorrencia.php,view/secretaria/pessoa.php,view/secretaria/plano.php,view/secretaria/questionario.php,view/admin/usoSistema.php' WHERE `Permissoes`.`tipo` = $ged; ");
        
        if ($ssp)
            $this->execute("UPDATE `academico`.`Permissoes` SET `permissao` = 'view/secretaria/relatorios/atendimento.php,view/secretaria/relatorios/ausencias.php,view/secretaria/relatorios/boletim.php,view/secretaria/relatorios/boletimTurma.php,view/secretaria/relatorios/frequencias.php,view/secretaria/relatorios/listagem.php,view/secretaria/calendario.php,view/secretaria/ocorrencia.php,view/admin/usoSistema.php,view/secretaria/questionario.php,view/secretaria/bolsa.php', `nome` = 'Atendimento ao Aluno,Aus&ecirc;ncias,Boletim do Aluno,Boletim Turma,Frequ&ecirc;ncias,Relat&oacute;rios (em PDF),Calend&aacute;rio,Ocorr&ecirc;ncias,Uso do Sistema,Questionários,Bolsas', `menu` = 'view/secretaria/relatorios/atendimento.php,view/secretaria/relatorios/ausencias.php,view/secretaria/relatorios/boletim.php,view/secretaria/relatorios/boletimTurma.php,view/secretaria/relatorios/frequencias.php,view/secretaria/relatorios/listagem.php,view/secretaria/calendario.php,view/secretaria/ocorrencia.php,view/admin/usoSistema.php,view/secretaria/questionario.php,view/secretaria/bolsa.php' WHERE `Permissoes`.`tipo` = $ssp;");
        
        $this->execute("UPDATE `academico`.`Permissoes` SET `permissao` = 'view/secretaria/relatorios/atendimento.php,view/secretaria/relatorios/ausencias.php,view/secretaria/relatorios/boletim.php,view/secretaria/relatorios/boletimTurma.php,view/secretaria/relatorios/frequencias.php,view/secretaria/relatorios/inconsistenciasNambei.php,view/secretaria/relatorios/listagem.php,view/secretaria/prazos/diario.php,view/secretaria/cursos/atividade_academica/atvAcadEmica.php,view/secretaria/cursos/atividade_academica/atvAcadItem.php,view/secretaria/cursos/atividade_academica/atvAcadRegistro.php,view/secretaria/atribuicao_docente/fpa.php,view/secretaria/atribuicao_docente/ftd.php,view/secretaria/atribuicao_docente/pit.php,view/secretaria/atribuicao_docente/rit.php,view/secretaria/plano.php', `nome` = 'Atendimento do Professor,Aus&ecirc;ncias,Boletim do Aluno,Boletim por Turma,Frequ&ecirc;ncias,Inconsist&ecirc;ncias Nambei,Relat&oacute;rios (em PDF),Di&aacute;rios,Cadastro de Atividades,Itens de Atividades,Registro de Alunos,FPA (Prefer&ecirc;ncia Atividades),FTDs (descontinuado),PIT (Plano I. Trabalho),RIT (Relat&oacute;rio I. Trabalho),Planos de Ensino', `menu` = 'view/secretaria/relatorios/atendimento.php,view/secretaria/relatorios/ausencias.php,view/secretaria/relatorios/boletim.php,view/secretaria/relatorios/boletimTurma.php,view/secretaria/relatorios/frequencias.php,view/secretaria/relatorios/inconsistenciasNambei.php,view/secretaria/relatorios/listagem.php,view/secretaria/prazos/diario.php,view/secretaria/cursos/atividade_academica/atvAcadEmica.php,view/secretaria/cursos/atividade_academica/atvAcadItem.php,view/secretaria/cursos/atividade_academica/atvAcadRegistro.php,view/secretaria/atribuicao_docente/fpa.php,view/secretaria/atribuicao_docente/ftd.php,view/secretaria/atribuicao_docente/pit.php,view/secretaria/atribuicao_docente/rit.php,view/secretaria/plano.php' WHERE `Permissoes`.`tipo` = $coord;");
        
        // ATUALIZAR VERSAO ATUAL
        $this->execute("UPDATE Instituicoes SET versao='435', versaoAtual='435'");
        printf("<br>Patch Academico52: OK");
    }

    //up()
    public function down() {
        
    }

    //down()
}
